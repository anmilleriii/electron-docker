FROM node:15.14.0

ENV ELECTRON_CACHE="/app/.cache/electron"
ENV ELECTRON_BUILDER_CACHE="/app/.cache/electron-builder"
ENV DISPLAY="DISPLAY"

# Install Electron dependencies
RUN apt update \
    && apt install -yqq \
    libnss3 \
    libgtk-3-0 \
    libxss1 \
    libasound2
# RUN snap install snapcraft --classic

# asdf
WORKDIR /usr/src/app/view
COPY package*.json ./
RUN npm install

COPY . ./

EXPOSE 8080
# USER daemon

# Install Vue app Node dependencies
# RUN npm install
# docker build -t mydevimage .
# --env YARN_CACHE_FOLDER="/app/.cache/yarn" \
# docker run --rm -it \
#     --env ELECTRON_CACHE="/app/.cache/electron" \
#     --env ELECTRON_BUILDER_CACHE="/app/.cache/electron-builder" \
#     --env="DISPLAY" \
#     --volume="$(pwd):/app" \
#     --volume="${HOME}/.Xauthority:/root/.Xauthority:rw" \
#     -it --net=host  \
#     -u "$(id -u):$(id -g)" \
#     -w "/app" \
#    mydevimage bash -c "npm install && npm run electron:build"


# docker run --rm -it \
#     --env="DISPLAY" \
#     -it --net=host  \
#     -u "$(id -u):$(id -g)" \
#     -w "/app" \
#     mydevimage bash -c "npm run electron:build"

# docker run -it mydevimage -u "$(id -u):$(id -g)"

